<!doctype html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Сандық жүйе тренажері</title>
  <style>
    :root{
      --bg1:#f7f0df;
      --bg2:#dce9ff;
      --card:#ffffff;
      --text:#162234;
      --muted:#607086;
      --primary:#0f6db2;
      --primary2:#0b9e9a;
      --good:#1f8a46;
      --bad:#c23838;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      padding:20px;
      display:grid;
      place-items:center;
      font-family:"Trebuchet MS","Segoe UI",sans-serif;
      color:var(--text);
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      position:relative;
      overflow-x:hidden;
    }

    body::before,
    body::after{
      content:"";
      position:fixed;
      border-radius:50%;
      filter:blur(2px);
      z-index:0;
    }

    body::before{
      width:280px;
      height:280px;
      right:-80px;
      top:-80px;
      background:rgba(15,109,178,.16);
    }

    body::after{
      width:220px;
      height:220px;
      left:-70px;
      bottom:-70px;
      background:rgba(11,158,154,.16);
    }

    .quiz{
      position:relative;
      z-index:1;
      width:min(860px,100%);
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.85);
      border-radius:20px;
      padding:22px;
      box-shadow:0 16px 50px rgba(21,40,74,.17);
      backdrop-filter:blur(6px);
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    h1{
      margin:0;
      font-size:clamp(1.2rem,2vw,1.7rem);
    }

    .badge{
      padding:7px 12px;
      border-radius:999px;
      background:linear-gradient(120deg,var(--primary),var(--primary2));
      color:#fff;
      font-weight:700;
      font-size:.9rem;
    }

    .meta{
      display:flex;
      justify-content:space-between;
      margin:14px 0 8px;
      color:var(--muted);
      font-weight:700;
    }

    #question{
      font-size:clamp(1.1rem,2.2vw,1.5rem);
      line-height:1.4;
      margin:10px 0 18px;
      padding:14px;
      border-radius:14px;
      background:#f8fbff;
      border:1px solid #e3ecf9;
    }
    #question sub{
      font-size:.68em;
      vertical-align:sub;
      line-height:0;
    }

    .options{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    .opt{
      border:1px solid #d8e5f8;
      background:#fff;
      border-radius:12px;
      padding:12px;
      text-align:left;
      font-size:1.02rem;
      color:var(--text);
      cursor:pointer;
      transition:.18s ease;
      min-height:52px;
    }
    .opt sub{
      font-size:.7em;
      vertical-align:sub;
      line-height:0;
    }

    .opt:hover:enabled{
      border-color:var(--primary);
      transform:translateY(-1px);
    }

    .opt:disabled{cursor:not-allowed; opacity:.96}
    .opt.correct{background:#e7f8ee; border-color:var(--good); color:var(--good); font-weight:700}
    .opt.wrong{background:#ffecec; border-color:var(--bad); color:var(--bad); font-weight:700}

    .feedback{
      min-height:24px;
      margin-top:12px;
      font-weight:700;
    }
    .feedback.ok{color:var(--good)}
    .feedback.bad{color:var(--bad)}

    .actions{
      margin-top:14px;
      display:flex;
      gap:10px;
    }

    .btn{
      border:none;
      border-radius:11px;
      padding:10px 14px;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      background:linear-gradient(120deg,var(--primary),var(--primary2));
      color:#fff;
    }

    .btn.secondary{
      background:linear-gradient(120deg,#64748b,#334155);
    }

    @media (max-width:720px){
      .quiz{padding:16px}
      .options{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <main class="quiz">
    <div class="top">
      <h1>Сандық жүйе тренажері</h1>
      <span id="badge" class="badge">Тест</span>
    </div>

    <div class="meta">
      <span id="progress">1/60</span>
      <span id="score">Ұпай: 0</span>
    </div>

    <div id="question"></div>
    <div id="options" class="options"></div>
    <div id="feedback" class="feedback"></div>

    <div class="actions">
      <button id="nextBtn" class="btn" hidden>Келесі</button>
      <button id="restartBtn" class="btn secondary" hidden>Қайта бастау</button>
    </div>
  </main>

  <script>
    const TOTAL_QUESTIONS = 60;
    const BASES = [2, 8, 10, 16];
    const CALC_OPS = ["+", "-", "*"];

    const state = {
      questions: [],
      idx: 0,
      score: 0
    };

    const el = {
      progress: document.getElementById("progress"),
      score: document.getElementById("score"),
      question: document.getElementById("question"),
      options: document.getElementById("options"),
      feedback: document.getElementById("feedback"),
      next: document.getElementById("nextBtn"),
      restart: document.getElementById("restartBtn"),
      badge: document.getElementById("badge")
    };

    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const pick = (arr) => arr[rand(0, arr.length - 1)];

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = rand(0, i);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function toBaseStr(num, base) {
      return num.toString(base).toUpperCase();
    }
    function formatWithBase(value, base) {
      return `${value}<sub>${base}</sub>`;
    }

    function isValidInBase(text, base) {
      const patterns = {
        2: /^[01]+$/,
        8: /^[0-7]+$/,
        10: /^[0-9]+$/,
        16: /^[0-9A-F]+$/
      };
      return patterns[base].test(text);
    }

    function addOption(set, decimalValue, base) {
      if (set.size >= 4) return;
      if (!Number.isInteger(decimalValue) || decimalValue < 0) return;
      set.add(toBaseStr(decimalValue, base));
    }

    function makeCalcOptions(correctDecimal, base) {
      const set = new Set([toBaseStr(correctDecimal, base)]);
      let guard = 0;

      while (set.size < 4 && guard < 240) {
        guard++;
        const shift = rand(1, 40);
        const sign = Math.random() < 0.5 ? -1 : 1;
        addOption(set, correctDecimal + sign * shift, base);
      }

      while (set.size < 4) {
        addOption(set, rand(0, Math.max(120, correctDecimal + 120)), base);
      }

      return shuffle([...set]);
    }

    function makeConvertOptions(decimalValue, toBase, rawText, fromBase) {
      const set = new Set([toBaseStr(decimalValue, toBase)]);

      if (/^[0-9]+$/.test(rawText)) {
        addOption(set, Number(rawText), toBase);
      }

      for (const wrongBase of BASES) {
        if (wrongBase === fromBase) continue;
        if (set.size >= 4) break;
        if (isValidInBase(rawText, wrongBase)) {
          addOption(set, parseInt(rawText, wrongBase), toBase);
        }
      }

      let guard = 0;
      while (set.size < 4 && guard < 240) {
        guard++;
        addOption(set, decimalValue + rand(-180, 180), toBase);
      }

      while (set.size < 4) {
        addOption(set, rand(0, 5000), toBase);
      }

      return shuffle([...set]);
    }

    function generateCalcQuestion(forcedOp = null) {
      const base = pick(BASES);
      const op = forcedOp || pick(CALC_OPS);

      let a = 0;
      let b = 0;
      let result = 0;

      if (op === "+") {
        a = rand(5, 150);
        b = rand(2, 120);
        result = a + b;
      } else if (op === "-") {
        a = rand(40, 260);
        b = rand(1, a - 1);
        result = a - b;
      } else {
        a = rand(2, 25);
        b = rand(2, 16);
        result = a * b;
      }

      return {
        type: "Есеп",
        prompt: `${toBaseStr(a, base)}<sub>${base}</sub> ${op} ${toBaseStr(b, base)}<sub>${base}</sub> = ?`,
        correct: toBaseStr(result, base),
        answerBase: base,
        options: makeCalcOptions(result, base)
      };
    }

    function generateConvertQuestion() {
      const fromBase = pick(BASES);
      const toBase = pick(BASES.filter((b) => b !== fromBase));
      const decimalValue = rand(1, 4095);

      const raw = toBaseStr(decimalValue, fromBase);
      const correct = toBaseStr(decimalValue, toBase);

      return {
        type: "Айналдыру",
        prompt: `${raw}<sub>${fromBase}</sub>  ->  ?<sub>${toBase}</sub>`,
        correct,
        answerBase: toBase,
        options: makeConvertOptions(decimalValue, toBase, raw, fromBase)
      };
    }

    function buildQuestions() {
      const calcCount = TOTAL_QUESTIONS / 2;       // 30
      const convertCount = TOTAL_QUESTIONS - 30;   // 30

      const forcedOps = [];
      for (let i = 0; i < calcCount; i++) {
        forcedOps.push(CALC_OPS[i % CALC_OPS.length]); // -, +, * аралас
      }

      const calcQuestions = shuffle(forcedOps).map((op) => generateCalcQuestion(op));
      const convertQuestions = Array.from({ length: convertCount }, () => generateConvertQuestion());

      return shuffle([...calcQuestions, ...convertQuestions]);
    }

    function renderQuestion() {
      const q = state.questions[state.idx];

      el.progress.textContent = `${state.idx + 1}/${TOTAL_QUESTIONS}`;
      el.score.textContent = `Ұпай: ${state.score}`;
      el.badge.textContent = q.type;
      el.question.innerHTML = q.prompt;
      el.options.innerHTML = "";
      el.feedback.textContent = "";
      el.feedback.className = "feedback";
      el.next.hidden = true;

      q.options.forEach((opt) => {
        const button = document.createElement("button");
        button.className = "opt";
        button.dataset.value = opt;
        button.innerHTML = formatWithBase(opt, q.answerBase);
        button.addEventListener("click", () => checkAnswer(button, opt, q.correct));
        el.options.appendChild(button);
      });
    }

    function checkAnswer(button, selected, correct) {
      const buttons = [...document.querySelectorAll(".opt")];
      buttons.forEach((b) => (b.disabled = true));

      if (selected === correct) {
        state.score += 1;
        button.classList.add("correct");
        el.feedback.textContent = "Дұрыс";
        el.feedback.className = "feedback ok";
      } else {
        button.classList.add("wrong");
        const rightButton = buttons.find((b) => b.dataset.value === correct);
        if (rightButton) rightButton.classList.add("correct");
        el.feedback.innerHTML = `Қате. Дұрыс жауап: ${formatWithBase(correct, state.questions[state.idx].answerBase)}`;
        el.feedback.className = "feedback bad";
      }

      el.score.textContent = `Ұпай: ${state.score}`;
      el.next.hidden = false;
      el.next.textContent = state.idx === TOTAL_QUESTIONS - 1 ? "Нәтиже" : "Келесі";
    }

    function showResult() {
      const percent = Math.round((state.score / TOTAL_QUESTIONS) * 100);
      el.badge.textContent = "Дайын";
      el.question.innerHTML = `Тест аяқталды: <b>${state.score}/${TOTAL_QUESTIONS}</b> (${percent}%)`;
      el.options.innerHTML = "";
      el.feedback.textContent = percent >= 80 ? "Керемет нәтиже." : "Жақсы, тағы қайталап көріңіз.";
      el.feedback.className = "feedback";
      el.next.hidden = true;
      el.restart.hidden = false;
    }

    function nextStep() {
      if (state.idx < TOTAL_QUESTIONS - 1) {
        state.idx += 1;
        renderQuestion();
      } else {
        showResult();
      }
    }

    function startQuiz() {
      state.questions = buildQuestions();
      state.idx = 0;
      state.score = 0;
      el.restart.hidden = true;
      renderQuestion();
    }

    el.next.addEventListener("click", nextStep);
    el.restart.addEventListener("click", startQuiz);

    startQuiz();
  </script>
</body>
</html>
